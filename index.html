<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LEARN WITH SHAZLY - Accurate 100%</title>

  <!-- Quranic font -->
  <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-color: #f0f9f2;
      --text-color: #000;
      --ayah-bg: #e6f4ea;
    }

    body.dark-mode {
      --bg-color: #1a1a1a;
      --text-color: #f0f0f0;
      --ayah-bg: #333;
    }

    body {
      font-family: 'Amiri', serif;
      direction: ltr;
      background: var(--bg-color);
      color: var(--text-color);
      padding: 30px;
      transition: background 0.3s, color 0.3s;
    }

    header {
      background: #4CAF50;
      color: white;
      padding: 30px;
      text-align: center;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .mode-buttons {
      margin-top: 15px;
    }

    .mode-buttons button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    select, input, button {
      margin: 10px 0;
      padding: 12px;
      width: 100%;
      max-width: 500px;
      font-size: 18px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button.action-btn {
      background: #4CAF50;
      color: white;
      cursor: pointer;
      border: none;
      transition: 0.3s;
    }

    button.action-btn:hover {
      background: #45a049;
    }

    .ayah {
      background: var(--ayah-bg);
      margin: 20px 0;
      padding: 25px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .ayah span {
      flex: 1 1 70%;
      margin-left: 30px;
      font-family: 'Scheherazade New', serif;
      font-size: 40px;
      line-height: 2.2;
      white-space: normal;
      overflow-wrap: break-word;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    .controls button {
      padding: 10px 20px;
      font-size: 18px;
    }

    audio {
      width: 100%;
      margin-top: 40px;
    }

    section {
      max-width: 900px;
      margin: auto;
    }

    .recorder {
      margin-top: 40px;
      padding: 20px;
      border: 2px dashed #4CAF50;
      border-radius: 10px;
    }

    .recorder button {
      margin: 5px;
      padding: 12px 25px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .recorder button:hover {
      opacity: 0.9;
    }

    #recordedAudio {
      margin-top: 20px;
      width: 100%;
    }
  </style>
</head>
<body>

  <header>
    <h1>LEARN WITH SHAZLY</h1>
    <p>100% Accurate Version with Light & Dark Mode</p>
    <div class="mode-buttons">
      <button onclick="setMode('dark')">üåô Dark Mode</button>
      <button onclick="setMode('light')">‚òÄÔ∏è Light Mode</button>
    </div>
  </header>

  <section>
    <h2>Select Surah and Ayah Range</h2>
    <select id="surahSelect">
      <option value="">Select Surah</option>
    </select><br/>

    <label>From Ayah:</label>
    <input type="number" id="fromAyah" min="1" placeholder="Ayah number from">

    <label>To Ayah:</label>
    <input type="number" id="toAyah" min="1" placeholder="Ayah number to">

    <button id="loadAyahs" class="action-btn">Load Ayahs</button>
    <div id="ayahs"></div>

    <h2>Student Recorder</h2>
    <div class="recorder">
      <button id="startRec">üî¥ Start Recording</button>
      <button id="pauseRec" disabled>‚è∏Ô∏è Pause Recording</button>
      <button id="stopRec" disabled>‚èπÔ∏è Stop Recording</button>
      <br/>
      <audio id="recordedAudio" controls></audio>
    </div>

    <audio id="audioPlayer" controls></audio>
  </section>

  <script>
    const surahNames = [
      "", "Al-Fatiha", "Al-Baqara", "Aali Imran", "An-Nisa", "Al-Ma'ida", "Al-An'am", "Al-A'raf", "Al-Anfal",
      "At-Tawba", "Yunus", "Hud", "Yusuf", "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", "Al-Isra",
      "Al-Kahf", "Maryam", "Ta-Ha", "Al-Anbiya", "Al-Hajj", "Al-Mu'minun", "An-Nur", "Al-Furqan", "Ash-Shu'ara",
      "An-Naml", "Al-Qasas", "Al-Ankabut", "Ar-Rum", "Luqman", "As-Sajda", "Al-Ahzab", "Saba", "Fatir",
      "Ya-Sin", "As-Saffat", "Sad", "Az-Zumar", "Ghafir", "Fussilat", "Ash-Shura", "Az-Zukhruf", "Ad-Dukhan", "Al-Jathiya",
      "Al-Ahqaf", "Muhammad", "Al-Fath", "Al-Hujurat", "Qaf", "Adh-Dhariyat", "At-Tur", "An-Najm", "Al-Qamar",
      "Ar-Rahman", "Al-Waqia", "Al-Hadid", "Al-Mujadila", "Al-Hashr", "Al-Mumtahina", "As-Saff", "Al-Jumua",
      "Al-Munafiqun", "At-Taghabun", "At-Talaq", "At-Tahrim", "Al-Mulk", "Al-Qalam", "Al-Haqqa", "Al-Ma'arij",
      "Nuh", "Al-Jinn", "Al-Muzzammil", "Al-Muddathir", "Al-Qiyama", "Al-Insan", "Al-Mursalat", "An-Naba", "An-Nazi'at",
      "Abasa", "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Inshiqaq", "Al-Buruj", "At-Tariq", "Al-A'la",
      "Al-Ghashiya", "Al-Fajr", "Al-Balad", "Ash-Shams", "Al-Lail", "Ad-Duha", "Ash-Sharh", "At-Tin", "Al-'Alaq",
      "Al-Qadr", "Al-Bayyina", "Az-Zalzala", "Al-Adiyat", "Al-Qari'a", "At-Takathur", "Al-Asr", "Al-Humaza",
      "Al-Fil", "Quraish", "Al-Ma'un", "Al-Kawthar", "Al-Kafirun", "An-Nasr", "Al-Masad", "Al-Ikhlas",
      "Al-Falaq", "An-Nas"
    ];

    const surahAyahCounts = [
      0, 7, 286, 200, 176, 120, 165, 206, 75, 129, 109, 123, 111, 43, 52, 99, 128,
      111, 110, 98, 135, 112, 78, 118, 64, 77, 227, 93, 88, 69, 60, 34, 30, 73,
      54, 45, 83, 182, 88, 75, 85, 54, 53, 89, 59, 37, 35, 38, 29, 18, 45, 60,
      49, 62, 55, 78, 96, 29, 22, 24, 13, 14, 11, 11, 18, 12, 12, 30, 52, 52,
      44, 28, 28, 20, 56, 40, 31, 50, 40, 46, 42, 29, 19, 36, 25, 22, 17, 19,
      26, 30, 20, 15, 21, 11, 8, 8, 19, 5, 8, 8, 11, 11, 8, 3, 9, 5, 4, 7, 3,
      6
    ];

    const surahSelect = document.getElementById('surahSelect');
    surahNames.forEach((name, index) => {
      if (index === 0) return;
      const opt = document.createElement('option');
      opt.value = index;
      opt.textContent = `${index}. ${name}`;
      surahSelect.appendChild(opt);
    });

    const fromAyahInput = document.getElementById('fromAyah');
    const toAyahInput = document.getElementById('toAyah');
    const loadAyahsBtn = document.getElementById('loadAyahs');
    const ayahsDiv = document.getElementById('ayahs');
    const audioPlayer = document.getElementById('audioPlayer');

    const partLinks = [
      "https://archive.org/download/1-6-quran-6236-ayah-by--alhosary--morattal---part1",
      "https://archive.org/download/2-6-quran-6236-ayah-by--alhosary--morattal---part2",
      "https://archive.org/download/3-6-quran-6236-ayah-by--alhosary--morattal---part3",
      "https://archive.org/download/4-6-quran-6236-ayah-by--alhosary--morattal---part4",
      "https://archive.org/download/ayaat-koran-5-6-quran-6236-ayah-by--alhosary--morattal____part5",
      "https://archive.org/download/6-6-quran-6236-ayah-by--alhosary--morattal---part6"
    ];

    const partStarts = [1, 1048, 2055, 3111, 4154, 5253];

    let ayahTexts = {};

    fetch('ayahTexts.json')
      .then(res => res.json())
      .then(data => {
        ayahTexts = data;
      })
      .catch(err => {
        console.error("Error loading ayahTexts.json:", err);
      });

    function getPartIndex(globalID) {
      for (let i = partStarts.length - 1; i >= 0; i--) {
        if (globalID >= partStarts[i]) return i;
      }
      return 0;
    }

    loadAyahsBtn.onclick = () => {
      const surahId = parseInt(surahSelect.value);
      const from = parseInt(fromAyahInput.value);
      const to = parseInt(toAyahInput.value);

      if (!surahId || !from || !to || from > to || to > surahAyahCounts[surahId]) {
        alert('Please enter valid values.');
        return;
      }

      ayahsDiv.innerHTML = '';

      for (let i = from; i <= to; i++) {
        let globalCounter = 0;
        for (let s = 1; s < surahId; s++) {
          globalCounter += surahAyahCounts[s];
        }
        globalCounter += i;

        const surahNum = String(surahId).padStart(3, '0');
        const ayahNum = String(i).padStart(3, '0');
        const fileName = `${surahNum}${ayahNum}.mp3`;
        const partIndex = getPartIndex(globalCounter);
        const audioUrl = `${partLinks[partIndex]}/${fileName}`;

        const div = document.createElement('div');
        div.className = 'ayah';

        const key = `${surahId}:${i}`;
        const text = ayahTexts[key]?.text || `Ayah ${i}`;
        const span = document.createElement('span');
        span.textContent = `[${i}] ${text}`;

        const controls = document.createElement('div');
        controls.className = 'controls';

        const playBtn = document.createElement('button');
        playBtn.textContent = '‚ñ∂Ô∏è Play';
        playBtn.onclick = () => {
          audioPlayer.src = audioUrl;
          audioPlayer.play();
        };

        const pauseBtn = document.createElement('button');
        pauseBtn.textContent = '‚è∏Ô∏è Pause';
        pauseBtn.onclick = () => {
          audioPlayer.pause();
        };

        const stopBtn = document.createElement('button');
        stopBtn.textContent = '‚èπÔ∏è Stop';
        stopBtn.onclick = () => {
          audioPlayer.pause();
          audioPlayer.currentTime = 0;
        };

        controls.appendChild(playBtn);
        controls.appendChild(pauseBtn);
        controls.appendChild(stopBtn);

        div.appendChild(span);
        div.appendChild(controls);
        ayahsDiv.appendChild(div);
      }
    };

    function setMode(mode) {
      if (mode === 'dark') {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
    }

    // Recorder
    let mediaRecorder;
    let recordedChunks = [];
    const startRec = document.getElementById('startRec');
    const pauseRec = document.getElementById('pauseRec');
    const stopRec = document.getElementById('stopRec');
    const recordedAudio = document.getElementById('recordedAudio');

    startRec.onclick = async () => {
      if (!navigator.mediaDevices) {
        alert('Your browser does not support audio recording.');
        return;
      }
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.start();
      recordedChunks = [];

      mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) recordedChunks.push(e.data);
      };

      mediaRecorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: 'audio/webm' });
        recordedAudio.src = URL.createObjectURL(blob);
      };

      startRec.disabled = true;
      pauseRec.disabled = false;
      stopRec.disabled = false;
    };

    pauseRec.onclick = () => {
      if (mediaRecorder.state === 'recording') {
        mediaRecorder.pause();
        pauseRec.textContent = '‚ñ∂Ô∏è Resume Recording';
      } else if (mediaRecorder.state === 'paused') {
        mediaRecorder.resume();
        pauseRec.textContent = '‚è∏Ô∏è Pause Recording';
      }
    };

    stopRec.onclick = () => {
      mediaRecorder.stop();
      startRec.disabled = false;
      pauseRec.disabled = true;
      stopRec.disabled = true;
      pauseRec.textContent = '‚è∏Ô∏è Pause Recording';
    };
  </script>

</body>
</html>
