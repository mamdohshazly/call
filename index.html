<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>LEARN WITH SHAZLY - النسخة الدقيقة 100%</title>

  <!-- الخط القرآني -->
  <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-color: #f0f9f2;
      --text-color: #000;
      --ayah-bg: #e6f4ea;
    }

    body.dark-mode {
      --bg-color: #1a1a1a;
      --text-color: #f0f0f0;
      --ayah-bg: #333;
    }

    body {
      font-family: 'Amiri', serif;
      direction: rtl;
      background: var(--bg-color);
      color: var(--text-color);
      padding: 30px;
      transition: background 0.3s, color 0.3s;
    }

    header {
      background: #4CAF50;
      color: white;
      padding: 30px;
      text-align: center;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .mode-buttons {
      margin-top: 15px;
    }

    .mode-buttons button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    select, input, button {
      margin: 10px 0;
      padding: 12px;
      width: 100%;
      max-width: 500px;
      font-size: 18px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button.action-btn {
      background: #4CAF50;
      color: white;
      cursor: pointer;
      border: none;
      transition: 0.3s;
    }

    button.action-btn:hover {
      background: #45a049;
    }

    .ayah {
      background: var(--ayah-bg);
      margin: 20px 0;
      padding: 25px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .ayah span {
      flex: 1 1 70%;
      margin-left: 30px;
      font-family: 'Scheherazade New', serif;
      font-size: 40px;
      line-height: 2.2;
      white-space: normal; /* لا قص */
      overflow-wrap: break-word; /* يكسر الأسطر الطويلة */
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .controls button {
      padding: 10px 20px;
      font-size: 18px;
    }

    audio {
      width: 100%;
      margin-top: 40px;
    }

    section {
      max-width: 900px;
      margin: auto;
    }
  </style>
</head>
<body>

  <header>
    <h1>LEARN WITH SHAZLY</h1>
    <p>نسخة دقيقة 100% مع الوضع الداكن والفاتح</p>
    <div class="mode-buttons">
      <button onclick="setMode('dark')">🌙 Dark Mode</button>
      <button onclick="setMode('light')">☀️ Light Mode</button>
    </div>
  </header>

  <section>
    <h2>اختيار السورة ونطاق الآيات</h2>
    <select id="surahSelect">
      <option value="">اختر سورة</option>
    </select><br/>

    <label>من الآية:</label>
    <input type="number" id="fromAyah" min="1" placeholder="رقم الآية من">

    <label>إلى الآية:</label>
    <input type="number" id="toAyah" min="1" placeholder="رقم الآية إلى">

    <button id="loadAyahs" class="action-btn">تحميل الآيات</button>
    <div id="ayahs"></div>
    <audio id="audioPlayer" controls></audio>
  </section>

  <script>
    // ✅ أسماء السور
    const surahNames = [
      "", "الفاتحة", "البقرة", "آل عمران", "النساء", "المائدة", "الأنعام", "الأعراف", "الأنفال",
      "التوبة", "يونس", "هود", "يوسف", "الرعد", "إبراهيم", "الحجر", "النحل", "الإسراء",
      "الكهف", "مريم", "طه", "الأنبياء", "الحج", "المؤمنون", "النور", "الفرقان", "الشعراء",
      "النمل", "القصص", "العنكبوت", "الروم", "لقمان", "السجدة", "الأحزاب", "سبأ", "فاطر",
      "يس", "الصافات", "ص", "الزمر", "غافر", "فصلت", "الشورى", "الزخرف", "الدخان", "الجاثية",
      "الأحقاف", "محمد", "الفتح", "الحجرات", "ق", "الذاريات", "الطور", "النجم", "القمر",
      "الرحمن", "الواقعة", "الحديد", "المجادلة", "الحشر", "الممتحنة", "الصف", "الجمعة",
      "المنافقون", "التغابن", "الطلاق", "التحريم", "الملك", "القلم", "الحاقة", "المعارج",
      "نوح", "الجن", "المزمل", "المدثر", "القيامة", "الإنسان", "المرسلات", "النبأ", "النازعات",
      "عبس", "التكوير", "الإنفطار", "المطففين", "الإنشقاق", "البروج", "الطارق", "الأعلى",
      "الغاشية", "الفجر", "البلد", "الشمس", "الليل", "الضحى", "الشرح", "التين", "العلق",
      "القدر", "البينة", "الزلزلة", "العاديات", "القارعة", "التكاثر", "العصر", "الهمزة",
      "الفيل", "قريش", "الماعون", "الكوثر", "الكافرون", "النصر", "المسد", "الإخلاص",
      "الفلق", "الناس"
    ];

    // ✅ عدد الآيات الحقيقية لكل سورة (بدقة)
    const surahAyahCounts = [
      0, 7, 286, 200, 176, 120, 165, 206, 75, 129, 109, 123, 111, 43, 52, 99, 128,
      111, 110, 98, 135, 112, 78, 118, 64, 77, 227, 93, 88, 69, 60, 34, 30, 73,
      54, 45, 83, 182, 88, 75, 85, 54, 53, 89, 59, 37, 35, 38, 29, 18, 45, 60,
      49, 62, 55, 78, 96, 29, 22, 24, 13, 14, 11, 11, 18, 12, 12, 30, 52, 52,
      44, 28, 28, 20, 56, 40, 31, 50, 40, 46, 42, 29, 19, 36, 25, 22, 17, 19,
      26, 30, 20, 15, 21, 11, 8, 8, 19, 5, 8, 8, 11, 11, 8, 3, 9, 5, 4, 7, 3,
      6
    ];

    const surahSelect = document.getElementById('surahSelect');
    surahNames.forEach((name, index) => {
      if (index === 0) return;
      const opt = document.createElement('option');
      opt.value = index;
      opt.textContent = `${index}. ${name}`;
      surahSelect.appendChild(opt);
    });

    const fromAyahInput = document.getElementById('fromAyah');
    const toAyahInput = document.getElementById('toAyah');
    const loadAyahsBtn = document.getElementById('loadAyahs');
    const ayahsDiv = document.getElementById('ayahs');
    const audioPlayer = document.getElementById('audioPlayer');

    const partLinks = [
      "https://archive.org/download/1-6-quran-6236-ayah-by--alhosary--morattal---part1",
      "https://archive.org/download/2-6-quran-6236-ayah-by--alhosary--morattal---part2",
      "https://archive.org/download/3-6-quran-6236-ayah-by--alhosary--morattal---part3",
      "https://archive.org/download/4-6-quran-6236-ayah-by--alhosary--morattal---part4",
      "https://archive.org/download/ayaat-koran-5-6-quran-6236-ayah-by--alhosary--morattal____part5",
      "https://archive.org/download/6-6-quran-6236-ayah-by--alhosary--morattal---part6"
    ];

    const partStarts = [1, 1048, 2055, 3111, 4154, 5253];

    let ayahTexts = {};

    fetch('ayahTexts.json')
      .then(res => res.json())
      .then(data => {
        ayahTexts = data;
      })
      .catch(err => {
        console.error("خطأ في تحميل ayahTexts.json:", err);
      });

    function getPartIndex(globalID) {
      for (let i = partStarts.length - 1; i >= 0; i--) {
        if (globalID >= partStarts[i]) return i;
      }
      return 0;
    }

    loadAyahsBtn.onclick = () => {
      const surahId = parseInt(surahSelect.value);
      const from = parseInt(fromAyahInput.value);
      const to = parseInt(toAyahInput.value);

      if (!surahId || !from || !to || from > to) {
        alert('الرجاء إدخال بيانات صحيحة.');
        return;
      }

      ayahsDiv.innerHTML = '';

      for (let i = from; i <= to; i++) {
        // ✅ احسب globalCounter بدقة
        let globalCounter = 0;
        for (let s = 1; s < surahId; s++) {
          globalCounter += surahAyahCounts[s];
        }
        globalCounter += i;

        const surahNum = String(surahId).padStart(3, '0');
        const ayahNum = String(i).padStart(3, '0');
        const fileName = `${surahNum}${ayahNum}.mp3`;
        const partIndex = getPartIndex(globalCounter);
        const audioUrl = `${partLinks[partIndex]}/${fileName}`;

        const div = document.createElement('div');
        div.className = 'ayah';

        const key = `${surahId}:${i}`;
        const text = ayahTexts[key]?.text || `آية ${i}`;
        const span = document.createElement('span');
        span.textContent = text;

        const controls = document.createElement('div');
        controls.className = 'controls';

        const playBtn = document.createElement('button');
        playBtn.textContent = '▶️ تشغيل';
        playBtn.onclick = () => {
          audioPlayer.src = audioUrl;
          audioPlayer.play();
        };

        const stopBtn = document.createElement('button');
        stopBtn.textContent = '⏹️ إيقاف';
        stopBtn.onclick = () => {
          audioPlayer.pause();
        };

        controls.appendChild(playBtn);
        controls.appendChild(stopBtn);

        div.appendChild(span);
        div.appendChild(controls);
        ayahsDiv.appendChild(div);
      }
    };

    [surahSelect, fromAyahInput, toAyahInput, loadAyahsBtn].forEach((el, idx, arr) => {
      el.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          const next = arr[idx + 1];
          if (next) next.focus();
        }
      });
    });

    function setMode(mode) {
      if (mode === 'dark') {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
    }
  </script>

</body>
</html>
