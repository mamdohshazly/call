<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Audio Recorder + EmailJS</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    .btn { padding: 10px 15px; margin: 10px 0; }
  </style>
</head>
<body>

  <h2>ğŸ“š ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡</h2>

  <label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…:</label>
  <input type="text" id="studentName"><br><br>

  <label>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
  <input type="email" id="studentEmail"><br><br>

  <button class="btn" id="startRec">ğŸ”´ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
  <button class="btn" id="stopRec" disabled>â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
  <button class="btn" id="sendBtn" style="display:none;">âœ‰ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button><br>

  <audio id="recordedAudio" controls style="display:none;"></audio>

  <script>
    emailjs.init("74-zUyeR-o7zE76GL"); // public key

    let mediaRecorder;
    let recordedChunks = [];
    let recordedBlob = null;

    const startBtn = document.getElementById("startRec");
    const stopBtn = document.getElementById("stopRec");
    const sendBtn = document.getElementById("sendBtn");
    const audioElement = document.getElementById("recordedAudio");

    startBtn.onclick = async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      recordedChunks = [];
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
      mediaRecorder.start();
      startBtn.disabled = true;
      stopBtn.disabled = false;
    };

    stopBtn.onclick = () => {
      mediaRecorder.stop();
      stopBtn.disabled = true;
      sendBtn.style.display = "inline";
      mediaRecorder.onstop = () => {
        recordedBlob = new Blob(recordedChunks, { type: "audio/webm" });
        const url = URL.createObjectURL(recordedBlob);
        audioElement.src = url;
        audioElement.style.display = "block";
      };
    };

    sendBtn.onclick = async () => {
      const name = document.getElementById("studentName").value;
      const email = document.getElementById("studentEmail").value;

      if (!name || !email || !recordedBlob) {
        alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø£ÙˆÙ„Ø§Ù‹.");
        return;
      }

      const base64 = await blobToBase64(recordedBlob);

      emailjs.send("service_vlapjef", "template_p0wtlnj", {
        from_name: name,
        from_email: email,
        base64_audio: base64
      }).then(() => {
        alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
        sendBtn.style.display = "none";
      }).catch(err => {
        alert("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + err.text);
      });
    };

    function blobToBase64(blob) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result.split(',')[1]); // remove header
        reader.onerror = reject;
        reader.readAsDataURL(blob);
      });
    }
  </script>

</body>
</html>
